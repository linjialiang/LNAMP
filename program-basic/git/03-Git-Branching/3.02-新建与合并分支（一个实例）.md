# 新建与合并分支（一个实例）
> 前面的讲解，让大家对 Git 分支有了大概理解，现在我们会用一个实例更加形象地去解说， Git 分支是如何帮助我们完成工作的！

## 这是本项目的一次实践演习
> 1. 该项目发布到 github 上后，已经有人在浏览
> 2. 为了 master 仓库项目的稳定，我们决定创建一个分支（ `dev3` ）
> 3. 以后都会先在 `dev3` 这个分支编辑内容，如果感觉可以了再让 `master` 合并分支
> 4. 有时浏览者发现我写的内容又错误，热心肠的就会通过 github 平台向我发起疑惑
> 5. 这时候我就会从 `dev3` 切换到 `master`
> 6. 跟 `master` 相同快照版本上创建一个解决 `浏览器发现的错误` 的修补分支( `bug1` )
> 7. 在解决了之后，切换回线上分支（ master ），然后合并这个 `bug1` 分支
> 8. 最后切换回 `dev3` 继续完成本项目的后续工作，我们后续的工作也都会在 `dev3` 分支里完成！

### 第一步：新建 `dev3` 分支，并切换到该分支
> 切换前，请确保已经提交所有修改！

```shell
$ git status -s
 M 3.02-新建与合并分支（一个实例）.md
$ git commit -a -m '提交所有修改，准备创建一个新分支 dev3'
[master f6153f8] 提交所有修改，准备创建一个新分支 dev3
  1 file changed, 17 insertions(+)
$ git push
Counting objects: 6, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (6/6), done.
Writing objects: 100% (6/6), 1.20 KiB | 613.00 KiB/s, done.
Total 6 (delta 3), reused 0 (delta 0)
remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
To https://github.com/linjialiang/programmer.git
   2dd1f67..f6153f8  master -> master
$ git checkout -b dev3
Switched to a new branch 'dev3'
$ git branch
* dev3
  master
  testing
```

> 到此我们的工作就已经开始在 `dev3` 分支进行了！
> - 注意到没，从这里看来，我们上节课漏删了 `testing` 分支，下面我们就来删除它

```shell
$ git branch --delete testing
Deleted branch testing (was f5c3963).
```

> `dev3` 这个新创建的分支在远程上并没有，我们需要将它推送到远程仓库
> - `git push github-programmer dev3` 指令可以推送本地分支（打标签的相关指令和分支类似）

```shell
$ git commit -a -m '推送本地分支 dev3 前，提交修改的数据'
$ git push github-programmer dev3
```

### 删除多余的远程分支
> 使用 `git branch -a` 可以查看所有本地分支和远程分支
> - 使用 `git branch -r` 可以只查看远程分支

```shell
$ git branch -r
  github-programmer/HEAD -> github-programmer/master
  github-programmer/dev
  github-programmer/dev2
  github-programmer/dev3
  github-programmer/master
```

> 在公司查看是正常的，但是回到家里，我们查看远程分支，发现 `dev` 虽然删除了，但是依然在记录里
> - 我们使用 `git remote show <remote-name>` 指令可以查看remote地址，远程分支，还有本地分支与之相对应关系等信息

```shell
$ git remote show github-programmer
* remote github-programmer
  Fetch URL: https://github.com/linjialiang/programmer.git
  Push  URL: https://github.com/linjialiang/programmer.git
  HEAD branch: master
  Remote branches:
    dev2                               tracked
    dev3                               tracked
    master                             tracked
    refs/remotes/github-programmer/dev stale (use 'git remote prune' to remove)
  Local branches configured for 'git pull':
    dev3   merges with remote dev3
    master merges with remote master
  Local refs configured for 'git push':
    dev3   pushes to dev3   (up to date)
    master pushes to master (up to date)
```

> 根据提示，告诉我们使用 `git remote prune <remote-name>` 命令来清除 `指定的远程仓库里不存在的分支` 的记录
> - 该指令必须加上 `<remote-name>`

```shell
$ git remote prune github-programmer
Pruning github-programmer
URL: https://github.com/linjialiang/programmer.git
 * [pruned] github-programmer/dev
```

> 我们发现 `dev3` 分支不能像 `master` 一样使用 `git [push|pull]`，需要使用 `git [push|pull] github-programmer dev3` 才能推送和获取远程仓库数据
> - 使用 `git branch --set-upstream-to=<remote-name>/<remote-branch> <local-branch>` 指令，将远程分支和本地分支绑定后就能使用 `git [push|pull]` 了

```shell
$ git branch --set-upstream-to=github-programmer/dev3 dev3
Branch 'dev3' set up to track remote branch 'dev3' from 'github-programmer'.
$ git pull
Already up to date.
$ git push
Everything up-to-date
```

> 我正在写的时候，github 发邮箱提醒我，有个读者向我提了个BUG大致是说：
> - 在 `2.06-为 Git 打标签.md` 这个小节中有一句错误的说明
> - 位置在 113 行，内容是:

```md
\> -   注意：这么做，应该新建一个本地仓库，再获取特定 Git 标签的数据，来作为新的分支
```

> 现在我要回到 `master` 分支去处理这件事情了
> - 回去之前我要先将 `dev3` 分支的修改全部提交上去

```shell
$ git commit -a -m '为了解决 issues1 问题，回到 master 前做一次提交操作'
```

```shell
$ git checkout master
error: unable to create file program-basic/git/03-Git-Branching/3.02-新建与合并分支（一个实例）.md: Permission denied
Switched to branch 'master'
D       program-basic/git/03-Git-Branching/3.02-新建与合并分支（一个实例）.md
Your branch is up to date with 'github-programmer/master'.
```

> 我们会发现切换到 master 分支的时候，会导致冲突文件直接删除，这该如何是好呢？
> - 这里我们建议同学们，切换分支前，先做一次合并，再进行切换，这是最简单的操作手法
> - 现在我们先进行文件恢复吧！

# 分支管理

> 现在已经创建、合并、删除了一些分支，让我们看看一些常用的分支管理工具

## 继上一小节的内容，我们需要做下准备

> 切换回 `dev3` 分支后，我们应该先要合并下 `master`，防止 `master` 分支上有内容修改，二 `dev3` 还未合并过来

```shell
$ git merge master
Updating e698f90..acf4c9c
Fast-forward
 program-basic/git/02-Git-Basics/2.06-为 Git 打标签.md | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
```

> 有一个内容在master上修改，这个文件直接快进，并没有冲突，我们不需要自行解决合并冲突问题！

## 关于 `git branch`

### 查看分支

> `git branch` 命令不只是可以创建于删除分支。如果不加任何参数运行它，会得到当前所有分支的一个列表：

```shell
$ git branch
  dev2
* dev3
  master
```

> 如果加上 `--remotes` 会显示所有远程分支

```shell
$ git branch --remotes
  github-programmer/dev2
  github-programmer/dev3
  github-programmer/master
```

> 假如加上 `--all` 会列出所有本地分支和远程分支

```shell
$ git branch --all
  dev2
* dev3
  master
  remotes/github-programmer/dev2
  remotes/github-programmer/dev3
  remotes/github-programmer/master
```

> 注意 `dev3` 分支前的 <font color=red>\*</font> 字符，代表现在检出的那一个分支是 `dev3`
>
> -   也就是说,当前 `HEAD` 指针所指向的分支是 `dev3`

## 如何删除分支

> 我们准备通过一个实例向大家讲解

### 实例流程

1.  新建分支-我们在特定的标签上创建一个新分支
2.  推送分支-将新分支推送到github 远程仓库
3.  关联分支-为本地分支和远程分支做关联
4.  取消关联-将本地分支和远程分支的关联取消
5.  新建标签-为这个新分支打上新标签
6.  确认标签-确认是否创建成功
7.  推送标签-将本地标签推送到远程
8.  删除标签-删除本地和远程指定标签
9.  删除新分支-删除本地和远程指定分支
10. 切换回 `dev3` 分支，继续未完成的工作

### 实例具体操作

1.  检出标签

    > `git checkout -b [branch-name] [tag-name]` 指令可以在特定的标签上创建一个新分支

    ```shell
    $ git checkout -b dev2 v2.0.10
    ```

    > `git checkout -b [branch-name] [tag-name]` 相当于下面2条指令

    ```shell
    $ git branch [branch-name] [tag-name]
    $ git checkout [branch-name]
    ```

2.  将分支推送到 github 远程仓库

    > 使用 `git push [remote-name] [branch-name]` 指令可以将指令的本地分支发送到远程仓库
    >
    > -   注意： `branch-name` 必须是存在的分支名
    > -   并且如果远程仓库有了该分支名，就会与本地仓库的同名分支同步

    ```shell
    $ git push github-programmer dev2
    Total 0 (delta 0), reused 0 (delta 0)
    To https://github.com/linjialiang/programmer.git
     * [new branch]      dev2 -> dev2
    ```

3.  为本地分支和远程分支做关联

    > 未关联前我们需要如下操作来上传和下载数据

    ```shell
    $ git push [remote-name] [branch-name]
    $ git pull [remote-name] [branch-name]
    ```

    > 使用 `upstream` 关联后，会变得很简单

    ```shell
    $ git push
    $ git pull
    ```

    > 下面是将 `dev2` 关联到 github 远程仓库的代码

    ```shell
    $ git push github-programmer
    fatal: The current branch dev2 has no upstream branch.
    To push the current branch and set the remote as upstream, use

        git push --set-upstream github-programmer dev2
    ```

    > 提示已经告诉我们该如何管理了，我们直接贴代码就可以！

    ```shell
    $ git push --set-upstream github-programmer dev2
    Everything up-to-date
    Branch 'dev2' set up to track remote branch 'dev2' from 'github-programmer'.
    ```

4.  将本地分支和远程分支的关联取消

    > 取消关联也很简单，使用 `git branch --unset-upstream <branch-name>...` 指令
    >
    > -   注意：取消当前分支的关联 `branch-name` 可以省略

    ```shell
    $ git branch --unset-upstream
    $ git pull
    There is no tracking information for the current branch.
    Please specify which branch you want to merge with.
    See git-pull(1) for details.

        git pull <remote> <branch>

    If you wish to set tracking information for this branch you can do so with:

        git branch --set-upstream-to=github-programmer/<branch> dev2
    ```

    > 看到没有，当前分支 `dev2` 已经跟远程取消关联了
    >
    > -   大家注意到提示的最后一句了没有，关联到远程分支的指令还可以这样写：
    > -   `git branch --set-upstream-to=github-programmer/<remote-branch-name> <local-branch-name>`
    > -   这种指令，是为了实现本地仓库分支名与远程仓库分支名不同的关联问题
    > -   忠告：这种情况应尽量避免，这是那种典型的给自己找麻烦的做法！

5.  为新分支打上新标签

    > `git tag -a <tag-name> -m 'info'` 为当前分支创建一个附注标签
    >
    > -   先为 `dev3` 打标签:

    ```shell
    $ git checkout dev3
    Switched to branch 'dev3'
    Your branch is up to date with 'github-programmer/dev3'.
    $ git tag -a v3.0.1-beta -m '内容已经很多了，我们为 dev3 分支打标签，证明我现在做了多少事情'
    $ git show v3.0.1-beta
    tag v3.0.1-beta
    Tagger: madnesslin <linjialiang@163.com>
    Date:   Sat Apr 28 15:27:03 2018 +0800

    内容已经很多了，我们为 dev3 分支打标签，证明我现在做了多少事情

    commit 2aaa977096cf9cf9dbb1c1db59f4690f45e6bfaa (HEAD -> dev3, tag: v3.0.1-beta, github-programmer/dev3)
    Author: madnesslin <linjialiang@163.com>
    Date:   Sat Apr 28 12:59:02 2018 +0800

        提交 */git/*/3.03-*.md 文件
        下一步准备在 v2.0.10 标签上创建新分支
    ...
    ```

    > 再给 `dev2` 打标签

    ```shell
    $ git checkout dev2
    Switched to branch 'dev2'
    Your branch is up to date with 'github-programmer/dev2'.
    $ git tag -a v2.0.11 -m '该标签内容跟 v2.0.10一致，这是演示给大家看，后面会将其 删除'
    ```

6.  查看标签是否创建成功

    > `git tag [-l <tag-name>...]` 来查看标签是否创建成功
    >
    > -   `<tag-name>` 支持简单的正则
    > -   `git tag` 会列出全部标签

    ```shell
    $ git tag -l v2.0.11 v3.0.1-beta
    v2.0.11
    v3.0.1-beta
    ```

    > 可以看到我们打的两个标签都成功了

7.  将本地标签推送到远程

    > 如果要不同远程上有本地没有的标签，我们使用 `git pull` 就可以直接下载远程仓库的标签到本地

    ```shell
    $ git pull
    From https://github.com/linjialiang/programmer
     * [new tag]         v3.0.1     -> v3.0.1
    Already up to date.
    ```

    > 如果要同步本地有但是远程上没有的标签，我们使用 `git push <remote-name> <tag-name>...`
    >
    > -   如果是多个标签我们直接使用 `git push <remote-name> --tags`

    ```shell
    $ git push github-programmer --tags
    Counting objects: 2, done.
    Delta compression using up to 4 threads.
    Compressing objects: 100% (2/2), done.
    Writing objects: 100% (2/2), 477 bytes | 477.00 KiB/s, done.
    Total 2 (delta 0), reused 0 (delta 0)
    To https://github.com/linjialiang/programmer.git
     * [new tag]         v2.0.11 -> v2.0.11
     * [new tag]         v3.0.1-beta -> v3.0.1-beta
    ```

8.  现在开始删除新标签（本地和远程）

    > 如果要删除的是远程没有，但是本地有的标签我们使用 `git tag --delete <tag-name>...`
    >
    > -   如果要删除远程标签我们使用 `git push --delete <remote-name> <remote-tag-name>`

    ```shell
    $ git tag --delete v3.0.1-beta v2.0.11
    Deleted tag 'v3.0.1-beta' (was e33d562)
    Deleted tag 'v2.0.11' (was 1a9d800)
    ```

    ```shell
    $ git push --delete github-programmer v2.0.11
    To https://github.com/linjialiang/programmer.git
     - [deleted]         v2.0.11
    $ git push --delete github-programmer v3.0.1-beta
    To https://github.com/linjialiang/programmer.git
     - [deleted]         v3.0.1-beta
    ```

9.  删除本地和远程指定分支

    > -   删除本地分支： `git branch --delete <branch-name>`
    > -   删除远程分支： `git push --delete github-programmer <branch-name>`

    ```shell
    $ git branch --delete dev2
    Deleted branch dev2 (was 99b9cf2).
    ```

10. 切换回 `dev3` 继续未完成的工作
> `git checkout dev3` 切换回 `dev3`

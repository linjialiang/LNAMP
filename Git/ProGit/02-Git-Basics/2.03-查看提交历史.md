# 查看提交历史

> 查看提交历史使用 `git log` 命令即可，这是最简单而有效的工具

## 不带参数的 `git log`

> 不带任何参数， `git log` 会按提交时间列出所有的更行，最近更行排在最上面！
>
> -   这种方式显示的信息是比较少的，只会列出每个提交的一下内容：
> -   SHA-1 校验和
> -   作者的名字和电子邮件地址
> -   提交时间和我们写的提交说明

```shell
$ git log
commit e466454a1f6e3e963898e972c3dcd6e017cfd0ad (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Date:   Sun Apr 22 15:24:34 2018 +0800

    **/git/*/2.02-*.md 小节完成！

commit 4bb95ed02ff23da934ab150fe95413cde9af5a7e
Author: madnesslin <linjialiang@163.com>
Date:   Sun Apr 22 15:07:12 2018 +0800

    commit 2.02-*.md !

...下面的提交历史条目省略
```

## 条目太多，能否指定最近几次的提交条目？

> 使用 `git log -<n>` 这种指令，可以指定的显示最近的提交条目
>
> -   下面的操作中我们会尽量多使用限制提交条目的方式来展现

```shell
$ git log -2
commit e466454a1f6e3e963898e972c3dcd6e017cfd0ad (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Date:   Sun Apr 22 15:24:34 2018 +0800

    **/git/*/2.02-*.md 小节完成！

commit 4bb95ed02ff23da934ab150fe95413cde9af5a7e
Author: madnesslin <linjialiang@163.com>
Date:   Sun Apr 22 15:07:12 2018 +0800

    commit 2.02-*.md !
```

## 显示的提交条目信息太简单了，能否显示每次提交的内容差异？

> `git log -p` 这个指令，可以显示每次提交的内容差异
> 下面用 `git log -p -1` 指令来测试下：

```shell
$ git log -p -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Date:   Mon Apr 23 10:05:54 2018 +0800

    2.03-*.md !

diff --git a/program-basic/git/02-Git-Basics/2.03-查看提交历史.md b/program-basic/git/02-Git-Basics/2.03-查看提交历史.md
index 7482e9e..0cd3492 100644
--- a/program-basic/git/02-Git-Basics/2.03-查看提交历史.md
+++ b/program-basic/git/02-Git-Basics/2.03-查看提交历史.md
@@ -48,5 +48,5 @@ Date:   Sun Apr 22 15:07:12 2018 +0800
 > git log -p 这个指令，可以显示每次提交的内容差异

-
+测试是否显示提交内容差异
```

> 上面的显示可以看到，除了显示基本信息之外，还附带了每次 `commit` 的变化
>
> -   在团队开发中，我们要快速浏览搭档提交的 `commit` 所带来的变化，这个选项很重要

## `git log` 其它好用的选项

### `git log --stat -<n>`

> 该选项会记录每次提交的简略统计信息

```shell
$ git log --stat -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Date:   Mon Apr 23 10:05:54 2018 +0800

    2.03-*.md !

 program-basic/git/02-Git-Basics/2.03-查看提交历史.md | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
```

### `git log --pretty=<value>`

> `--pretty` 有多个选项：跟默认的 `git log` 都有所区别
>
> -   查看表 1：

| `--pretty` 选项 | 作用说明         |
| ------------- | ------------ |
| `oneline`     | 将每个提交放在一行显示  |
| `short`       | 显示 3 行信息     |
| `full`        | 显示 4 行信息     |
| `fuller`      | 显示更多信息       |
| `format`      | 自己定制要显示的记录格式 |

```shell
$ git log -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Date:   Mon Apr 23 10:05:54 2018 +0800

    2.03-*.md !
```

```shell
$ git log --pretty=short -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author: madnesslin <linjialiang@163.com>

    2.03-*.md !
```

```shell
$ git log --pretty=full -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author: madnesslin <linjialiang@163.com>
Commit: madnesslin <linjialiang@163.com>

    2.03-*.md !
```

```shell
$ git log --pretty=fuller -1
commit 0cd8dd405383568f4587b79ff84f4af7276fc6b1 (HEAD -> master)
Author:     madnesslin <linjialiang@163.com>
AuthorDate: Mon Apr 23 10:05:54 2018 +0800
Commit:     madnesslin <linjialiang@163.com>
CommitDate: Mon Apr 23 10:05:54 2018 +0800

    2.03-*.md !
```

```shell
$ git log --pretty=format:"%h - %ar, %cd : %s" -1
0cd8dd4 - 55 minutes ago, Mon Apr 23 10:05:54 2018 +0800 : 2.03-*.md !
```

### `git log --pretty=format:<value>` 说明

> 这种方式可以按自己的要求显示记录格式，特别是对于后期提取分析格外有用
>
> -   `format:<value>` 中的 vaule 值如果是组合形式，请用引号（单引号，双引号都可以）
> -   下面是 `--pretty=format:<value>` 的常用选项（表 2）：
> -   `--pretty=format:<value>` 可以简写成 `--pretty="<value>"`，在以后的运用中我们会尽量使用简写

| `--pretty=format:<value>` 选项 | 选项说明                                              |
| ---------------------------- | ------------------------------------------------- |
| `%H`                         | 提交对象 `commit` 的完整哈希字串                             |
| `%h`                         | 提交对象的简短哈希字串                                       |
| `%T`                         | 树对象 `tree` 的完整哈希字串                                |
| `%t`                         | 树对象的简短哈希字串                                        |
| `%P`                         | 父对象 `Parent` 的完整哈希字串                              |
| `%p`                         | 父对象的简短哈希字串                                        |
| `%an`                        | `author name` ，作者 `author` 的名字                    |
| `%ae`                        | `author email` ，作者的电子邮件地址                         |
| `%ad`                        | `author date` ，作者修订日期，可以用 `--date=<value>` 选项定制格式 |
| `%ar`                        | 作者修订日期，按多久以前的方式显示（常用）                             |
| `%cn`                        | `commit name` ，提交者 `committer` 的名字                |
| `%ce`                        | `commit email` ，提交者的电子邮件地址                        |
| `%cd`                        | `commit date`，提交日期                                |
| `%cr`                        | 提交日期，按多久以前的方式显示（常用）                               |
| `%s`                         | 提交说明                                              |

> 作者和提交具体是什么关系呢？
>
> -   作者，指的是对文件实际修改的人
> -   提交者，指的是最后将这次所有工作内容提交到仓库的人
> -   打个比方： `成员A` 为该项目发布了补丁， `成员B` 将补丁并入项目中，在这里 `作者 = 成员A` `提交者 = 成员B`

### 表 3. `git log` 的常用选项

> 实际操作中，不同选项间组合使用的效果会更好

| 选项                | 说明                                                                  |
| ----------------- | ------------------------------------------------------------------- |
| `-p`              | 按补丁格式显示每个更新之间的差异                                                    |
| `--stat`          | 显示每次更新的文件修改统计信息                                                     |
| `--shortstat`     | 只显示 `--stat` 中最后的行数修改添加移除统计                                         |
| `--name-only`     | 仅在提交信息后，显示已修改的文件清单                                                  |
| `--name-status`   | 显示新增、修改、删除的文件清单                                                     |
| `--abbrev-commit` | 仅显示 SHA-1 的前几个字符，而非所有的40个字符                                         |
| `--graph`         | 显示 ASCII 图形拜师的分支合并历史                                                |
| `--pretty`        | 使用其他格式显示历史提交信息。可用的选项包括 `oneline` `short` `full` `fuller` 和 `format` |

### 表 4. 限制 `git log` 输出的选项

> 实际操作中，都是跟其它选项混合使用效果更佳
>
> -   对于组合的选项，Windows默认情况是仅输出 `满足所有选项` 的提交记录（与《Pro Git》刚好相反）
> -   这个特性应该可以设置，同学有兴趣的可以去研究下
> -   下面贴出《Pro Git》的说明：组合选项会输出满足其中任意一项的提交记录，如果希望仅输出满足全部选项的提交记录，需要加上 `--all-match`

| 选项                   | 说明                |
| -------------------- | ----------------- |
| `-<n>`               | 仅显示最近的 n 条提交      |
| `--since`, `--after` | 仅显示指定时间之后的提交      |
| `until`, `--before`  | 仅显示指定时间之间的提交      |
| `--author`           | 仅显示指定作者相关的提交      |
| `--committer`        | 仅显示指定提交者相关的提交     |
| `--grep`             | 仅显示含指定关键字的提交      |
| `-S` （S 是大写的）        | 仅显示添加或移除了某个关键字的提交 |

> 下面是一些例子：

1.  输出最近 1 条提交记录

    ```shell
    $ git log --pretty=oneline -1
    54e6aac5180f15a13be86dcbeed907f0228e5f48 (HEAD -> master) commit **/git/*/2.03-*.md !
    ```

2.  输出指定时间的提交记录

    > 输出 `2018-04-21 20:00:00` 往后， `2018-04-22 12:00:00` 往前，这个时间段里提交的记录
    >
    > -   这里有个规律，不理解可以在草稿纸，按x轴，从左到右排列下22号到21号的所有时间点，自然会明白
    > -   注意： `--after` 和 `--before` 可以组合使用，也可以独立使用

    ```shell
    $ git log --pretty="%h - %cd - %s" --before="2018-04-22 12:00:00" --after="2018-04-21 20:00:00"
    ed7d43d - Sun Apr 22 10:23:24 2018 +0800 - commit **/git/*/2.02-*.md !
    87191f9 - Sat Apr 21 23:14:41 2018 +0800 - 没有使用 git add <file> 跳过使用暂存
    区域直接使用 git commit -a 提交!
    ac27161 - Sat Apr 21 23:05:41 2018 +0800 - 没有使用 git add <file> 跳过使用暂存
    区域直接使用 git commit -a 提交!
    c54aca3 - Sat Apr 21 22:48:39 2018 +0800 - 提交了 2.02-*md 文件！
    68717bd - Sat Apr 21 22:31:19 2018 +0800 - commit git/README.md !
    4445f01 - Sat Apr 21 22:28:45 2018 +0800 - commit ... !
    7f902a1 - Sat Apr 21 22:25:47 2018 +0800 - commit .gitignore ... !
    8d77ce9 - Sat Apr 21 20:51:42 2018 +0800 - commit 2.02-*.md !
    ```

3.  输出指定作者的提交记录

    > 指定作者 和 指定提交者写法一样，这里就举 1 例
    >
    > -   如果作者姓名带有空格请使用引号扩起来

    ```shell
    $ git log --author=demo1
    commit 1463ee822c132fad2145fa482aa8aaf4516b9cf3
    Author: demo1 <demo1@163.com>
    Date:   Mon Apr 23 11:30:27 2018 +0800

        2.03-*.md 文件由 madnesslin 修改，最终的提交由 demo1 完成 ！
    ```

4.  输出存在指定关键词的提交记录

    > 我们提交时，需要输入提交说明，这里搜索的就是提交说明里的内容
    >
    > -   这个查询指令非常好用，当然前提是你要认真写好每次的提交备注

    ```shell
    $ git log --pretty="%h - %cd - %s" --grep="2.03"
    84a6d3c - Mon Apr 23 13:48:19 2018 +0800 - commit **/git/*/2.03-*.md !
    54e6aac - Mon Apr 23 12:40:13 2018 +0800 - commit **/git/*/2.03-*.md !
    f86f276 - Mon Apr 23 12:36:24 2018 +0800 - commit **/git/*/2.03-*.md !
    1463ee8 - Mon Apr 23 11:30:27 2018 +0800 - 2.03-*.md 文件由 madnesslin 修改，最
    终的提交由 demo1 完成 ！
    0cd8dd4 - Mon Apr 23 10:05:54 2018 +0800 - 2.03-*.md !
    789bd7a - Mon Apr 23 10:05:47 2018 +0800 - 2.03-*.md !
    6932478 - Mon Apr 23 10:03:23 2018 +0800 - commit **/git/*/2.03-*.md !
    619adbe - Mon Apr 23 10:02:29 2018 +0800 - commit **/git/*/2.03-*.md !
    ```

5.  输出添加或移除了某个关键字的提交记录

    > `--grep=<value>` 是针对提交时自己写的内容，而 `-S<value>` 针对的是文件中发生改变的词！
    >
    > -   假如，我们有一天发现自己的项目突然不能正常运行了，通过检测分析是有一个函数名写错，我们就可以使用这个方法寻找了

    ```shell
    $ git log -S"表 3"
    commit f86f276df9d809508f4c6e47a9d476fd8e3e39c5
    Author: madnesslin <linjialiang@163.com>
    Date:   Mon Apr 23 12:36:24 2018 +0800

        commit **/git/*/2.03-*.md !
    ```

6.  输出指定路径（目录或文件）的历史提交记录

    > 指令 `git log -- <path>...`
    >
    > -   注意：这个指令应该放在其它所有指令的后面
    > -   也就是最后面 `--` 和 `<path>` 之间需要空格隔开

    ```shell
    $ git log --pretty="%h - %an - %ar" -- README.md
    68717bd - madnesslin - 2 days ago
    7f902a1 - madnesslin - 2 days ago
    ```

> 到此查看提交历史讲解的差不多了，先总结下：
>
> 1.  `git log` 用来查看提交的历史记录
> 2.  `git log` 有很多选项，来帮助使用者，能快速的定位到，自己想要的快照版本
> 3.  `git log` 定位到了自己想要的快照，我们就可以对当前数据，进行针对性修改
> 4.  结合 `2.02*-md` 小节讲解的知识点，我们已经可以做很多事情了
> 5.  接下来我们会在详细讲解 撤销操作 这个功能，实际工作中都是撤销操作和本小节内容一起使用

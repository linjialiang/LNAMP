# Nginx 配置案例

## 提供静态内容

> 一个重要的 Web 服务器任务是提供文件（例如图像或静态 HTML 页面）。

```text
我们将实现一个示例，根据请求，将从不同的本地目录提供文件：
    - 包含HTML文件的目  /data/www
    - 包含图像的目录   /data/images
- 这将需要编辑配置文件并在 http 块内设置 server 块，其中包含两个 location 块。
```

> 具体操作如下：

1. 首先，创建 /data/www 目录并将带有任何文本内容的 index.html 文件放入其中，然后创建 /data/images 目录并在其中放置一些图像。

2. 下来，打开配置文件。默认配置文件已包含几个 server 块的示例，主要是注释掉的。现在注释掉所有这些块并启动一个新的 server 块：

   ```conf
   http {
       server {
       }
   }
   ```

   ```text
   - 通常，配置文件可能包含几个 server 块 distinguished ，它们通过 listen 到 server names 。
   - 一旦nginx决定哪个 server 处理请求，它就会根据 server 块中定义的 location 指令的参数测试请求头中指定的URI。
   ```

3. 将以下 location 块添加到 server 块：

   ```conf
   location / {
       root /data/www;
   }
   ```

   ```text
   - 此 location 块指定与请求中的URI进行比较的“/”前缀。
   - 对于匹配请求，URI将添加到 root 指令中指定的路径，
        - 即：/data/www，以形成本地文件系统上所请求文件的路径。
   - 如果存在多个匹配的 location 块，则nginx选择具有最长前缀的块。
   - 上面的 location 块提供了最短的前缀，长度为1，因此只有当所有其他 location 块无法提供匹配时，才会使用此块。
   ```

4. 接下来，添加第二个 location 块：

   ```conf
   location /images/ {
       root /data;
   }
   ```

   > 它将匹配以 /images/ 开头的请求（ location / 也匹配此类请求，但前缀较短）。

5. server 块的结果配置应如下所示：

   ```conf
   server {
       location / {
           root /data/www;
       }

       location /images/ {
           root /data;
       }
   }
   ```

   ```text
   - 这已经是服务器的工作配置，它可以侦听标准端口80，并且可以在本地计算机上访问 http://localhost/ 。
   - 为响应具有以 /images/ 开头的URI的请求，服务器将从 /data/images 目录发送文件。例如，
        - 响应 http://localhost/images/example.png 请求，
        - nginx将发送 /data/images/example.png 文件。
        - 如果此类文件不存在，nginx将发送指示404错误的响应。
    - URI不以 /images/ 开头的请求将映射到 /data/www 目录。例如，
        - 响应 http://localhost/some/example.html 请求，
        - nginx将发送 /data/www/some/example.html 文件。
   ```

6. 要应用新配置，请启动 nginx（如果尚未启动）或通过执行以下命令将 reload 信号发送到 nginx 的主进程：

   ```shell
   $ nginx -s reload
   ```

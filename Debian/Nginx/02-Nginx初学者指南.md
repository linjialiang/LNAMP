# Nginx 初学者指南

> 本指南提供了对 nginx 的基本介绍，并介绍了可以使用它完成的一些简单任务。

## 启动，停止和重新加载配置

1. 启动 Nginx

   > 要启动 nginx，请运行可执行文件。使用以下语法：

   ```shell
   $ nginx
   ```

2. nginx 指令信号

   > 启动 nginx 后，可以通过使用-s 参数调用可执行文件来控制它。使用以下语法：

   ```shell
   $ nginx -s 信号
   ```

   > 可选信号列表

   | 信号            | 描述             |
   | --------------- | ---------------- |
   | nginx -s stop   | 快速关闭         |
   | nginx -s quit   | 优雅的关闭       |
   | nginx -s reload | 重新加载配置文件 |
   | nginx -s reopen | 重新打开日志文件 |

3. 信号详解

   > 例如，要停止 nginx 进程，等待 worker 进程完成服务当前请求，可以执行以下命令:

   ```shell
   # 这个命令应该在启动 nginx 的同一用户下执行。
   $ nginx -s quit
   ```

   > 要获取所有正在运行的 nginx 进程的列表，ps 可以使用该实用程序，例如，通过以下方式：

   ```shell
   $ ps -ax | grep nginx
   ```

## Nginx 配置文件

> Nginx 配置文件(nginx.conf)由上下文及指令组成，这些指令由对应的模块控制，结构如下：

```text
## =============================================================================
##                              【Nginx 配置文件结构】
## =============================================================================
├─ main                                     核心，配置影响nginx全局的指令
|   ├─events                                配置影响nginx服务器或与用户的网络连接
|   |
|   ├─stream                                处理网络通信协议的第4层(tcp/udp)
|   |  ├─upstream                           4层负载均衡
|   |  ├─server                             4层代理、4层反向代理
|   |  └─ ...
|   |
|   ├─http                                  处理网络通信协议的第7层(tcp/ip)
|   |  ├─upstream                           7层负载均衡
|   |  ├─server                             虚拟主机、7层代理、7层反向代理
|   |  |  ├─location                        配置请求的路由，以及各种页面的处理情况。
|   |  |  └─ ...
|   |  └─ ...
|   |
|   ├─mail                                  代理邮箱服务器
|   |  ├─server
|   |
|
└─
```

## Nginx 模块详解

> Nginx 有很多模块，模块的具体作用可以在配置文件的通过指令来实现，而不同的模块只能出现在规定的上下文里才有作用。

### 核心（main）

> 配置影响 nginx 全局的指令，一般来讲 [Nginx 核心功能](./Nginx核心功能.md) 里的指令都允许写在核心区域上。

### events 上下文

> 配置影响 nginx 服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。

### stream 上下文

> 处理网络通信中的 第 4 层协议（TCP/UDP），如：4 层代理、4 层反向代理、4 层负载均衡

- upstream 上下文

  > 处理 `IP+端口` 的负载均衡

- server 上下文

  > 处理 `IP+端口` 代理以及反向代理

### http 上下文

> 处理 `http/https协议` 的指令都在这里，`http上下文` 拥有的子模块非常多

```text
- http上下文,可以嵌套多个 server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。
- 如文件引入，mime-type 定义，日志自定义，是否使用 sendfile 传输文件，连接超时时间，单连接请求数等。
```

- upstream 上下文

  > 处理 `HTTP/HTTPS` 的负载均衡

- server 上下文

  > 配置虚拟主机的相关参数，一个 `http上下文` 中可以有多个 `server块`。

- location 上下文

  > 配置请求的路由，以及各种页面的处理情况。

### mail 上下文

> 处理邮箱代理转发。

- server 上下文

  >

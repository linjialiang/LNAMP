<!-- TOC START min:1 max:3 link:true asterisk:false update:true -->
- [挂载数据盘](#挂载数据盘)
    - [挂载 lvm 逻辑卷](#挂载-lvm-逻辑卷)
        - [删除分区](#删除分区)
        - [创建 LVM 分区](#创建-lvm-分区)
        - [安装 lvm2 包](#安装-lvm2-包)
        - [创建逻辑卷](#创建逻辑卷)
        - [格式化逻辑卷](#格式化逻辑卷)
        - [挂载分区](#挂载分区)
        - [卸载分区](#卸载分区)
    - [挂载普通分区](#挂载普通分区)
    - [LVM 逻辑卷管理命令](#lvm-逻辑卷管理命令)
        - [fdisk 指令](#fdisk-指令)
        - [mkfs 指令](#mkfs-指令)
        - [PV 指令](#pv-指令)
        - [VG 指令](#vg-指令)
        - [LV 指令](#lv-指令)
        - [lvm 其它指令](#lvm-其它指令)
<!-- TOC END -->

# 挂载数据盘

> 安装完成后有 2 个 50G 的虚拟硬盘还未绑定到指定目录下，这里是具体操作：

## 挂载 lvm 逻辑卷

> 挂载 lvm 逻辑卷比较复杂，也是重点讲解部分！

### 删除分区

> 先将这两个数据盘的分区全部删除操作如下：

```shell
$ fdisk /dev/sdb 或 /dev/sdc
$ d
$ 回车
$ ...直到出现红色警告文字
$ w
```

### 创建 LVM 分区

> `8e` 是 lvm 分区类型的 `标识`

```shell
$ fdisk -l
$ fdisk /dev/sdb 或 /dev/sdc
$ n
$ e
$ 3次回车
$ w
$ fdisk /dev/sdb 或 /dev/sdc
$ t
$ 8e
$ w
```

### 安装 lvm2 包

> 假如 lvm2 包没有安装，是无法进行下面的操作的

```shell
$ apt list lvm2
$ apt-get install lvm2
```

### 创建逻辑卷

> 将 /dev/sdb1 和 /dev/sdc1 转化成 `LVM 物理卷`

```shell
$ pvcreate /dev/sd{b,c}1
$ pvs
$ pvscan
$ pvdisplay
```

> 将 `物理卷 /dev/sd{b,c}1` 加入 `LVM卷组 vg_data`

```shell
$ vgcreate vg_data /dev/sd{b,c}1
$ vgs
$ vgscan
$ vgdisplay
$ pvdisplay
```

> 将 `物理卷（2个数据盘）` 的容量都给 `LVM逻辑卷 lv_data`

```shell
$ lvcreate -l 100%VG -n lv_data vg_data
$ lvs
$ lvscan
$ lvdisplay
```

### 格式化逻辑卷

> 速度慢，带 -c 会检测是否坏轨

```shell
$ mkfs -V -t ext4 -c /dev/vg_data/lv_data
```

> 速度快

```shell
$ mkfs -V -t ext4 /dev/vg_data/lv_data
```

### 挂载分区

> 创建 `/data` 这个挂载目录

```shell
$ mkdir /data
```

> 挂载 lvm 逻辑分区到指定目录

```shell
$ lvdisplay
$ mount /dev/vg_data/lv_data /data
$ df -h
```

> 开机自动挂载

```shell
$ lvdisplay # 获取lv_data 的 LV Path
$ cp /etc/fstab{,.bak}
$ vi /etc/fstab
```

> 在 /etc/fstab 文件底部增加如下两行：

```conf
# /data was on /dev/vg_data/lv_data during installation
/dev/mapper/vg_data-lv_data /data       ext4    defaults        0       0
```

> 或者

```conf
# /data was on /dev/vg_data/lv_data during installation
/dev/vg_data/lv_data /data       ext4    defaults        0       0
```

### 卸载分区

```shell
$ umount /data
```

## 挂载普通分区

> 挂载普通分区非常简单，这里给大家一个思路

| 步骤         | 描述                          |
| ------------ | ----------------------------- |
| 磁盘分区     | 使用 fdisk 分区               |
| 格式化分区   | 将分区格式化成 ext4 格式      |
| 挂载         | 使用 mount 指令挂载到指定目录 |
| 卸载         | 使用 umount 指令将分区卸载    |
| 开启自动挂载 | 修改 `/etc/fstab` 文件        |

```shell
$ vi /etc/fstab
```

> 在 /etc/fstab 文件底部增加如下两行：

```conf
# /data was on /dev/sdb1 during installation
/dev/sdb1 /data       ext4    defaults        0       0
```

## LVM 逻辑卷管理命令

> LVM 逻辑卷管理一般涉及到 `fdisk` 、 `mkfs` 以及 `lvm2自带的指令`

### fdisk 指令

### mkfs 指令

### PV 指令

> PV 是处理物理卷的相关指令

1. 物理硬盘格式化为物理卷(PV):

```shell
$ pvcreate /dev/sd{b,c}1
```

2. 显示物理卷(PV)信息:

```shell
$ pvs
$ pvscan
$ pvdisplay
```

3. 删除物理卷(PV):

```shell
$ pvremove /dev/sd{b,c}1
```

### VG 指令

1. 创建卷组(VG),并将物理卷(PV)加入到卷组中:

```shell
$ vgcreate vg_data /dev/sd{b,c}1
```

2. 将物理卷(PV)从指定卷组(VG)中移除(使用中的 PV 不能移除)：

```shell
$ vgreduce vg_data /dev/sdb1
```

3. 从卷组(VG)中移除缺失物理硬盘：

```shell
$ vgreduce --removemissing vg_data
```

4. 显示卷组(VG)信息：

```shell
$ vgs
$ vgscan
$ vgdisplay
```

5. 增加卷组(VG)空间：

```shell
$ vgextend vg_data /dev/sdd1
```

6. 删除卷组(VG):

```shell
$ vgremove vg_data
```

### LV 指令

1. 基于卷组(VG)创建逻辑卷(LV)

```text
lvcreate指令：创建逻辑卷
    【语法】lvcreate [选项] [参数]
    【功能介绍】lvcreate 指令用于创建LVM的逻辑卷。
    主要参数：
        -L 指定逻辑卷大小，单位为“bBsSkKmMgGtTpPeE”字节
        -l 指定逻辑扩展数，单位“VG|FREE|ORIGIN”
        -n 后面跟逻辑卷名
        -s 创建快照
```

```shell
$ lvcreate -L 10G -n lv_001 vg_data
$ lvcreate -l 20%VG -n lv_002 vg_data
$ lvcreate -l 100%FREE -n lv_003 vg_data
```

2. 显示逻辑卷(LV)信息:

```shell
$ lvs
$ lvscan
$ lvdisplay
```

3. 删除逻辑卷(LV):

```shell
$ lvremove /dev/vg_data/lv_data
```

4. 激活修复后的逻辑卷(LV):

```shell
$ lvchange -ay /dev/vg_data/lv_data
```

5. 增加逻辑卷(LV)空间:

```shell
$ lvextend -L +3G /dev/vg_data/lv_data
```

### lvm 其它指令

1. 更新逻辑卷(LV):

```shell
$ resize2fs /dev/vg_data/lv_data
```

2. 检查逻辑卷(LV)文件系统:

```shell
$ e2fsck -f /dev/vg_data/lv_data
```

3. 减少逻辑卷(LV)空间:

```shell
$ resize2fs /dev/vg_data/lv_data 4G
$ lvreduce -L -1G /dev/vg_data/lv_data
```
